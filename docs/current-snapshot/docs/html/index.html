<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="Tadaya Tsuyukubo">
<title>Datasource Micrometer Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<style>
.hidden {
	display: none;
}

.switch {
	border-width: 1px 1px 0 1px;
	border-style: solid;
	border-color: #7a2518;
	display: inline-block;
}

.switch--item {
	padding: 10px;
	background-color: #ffffff;
	color: #7a2518;
	display: inline-block;
	cursor: pointer;
}

.switch--item:not(:first-child) {
	border-width: 0 0 0 1px;
	border-style: solid;
	border-color: #7a2518;
}

.switch--item.selected {
	background-color: #7a2519;
	color: #ffffff;
}

</style>
<script type="text/javascript">
function addBlockSwitches() {
	for (var primary of document.querySelectorAll('.primary')) {
		var switchItem = createSwitchItem(primary, createBlockSwitch(primary));
		switchItem.item.classList.add("selected");
		var title = primary.querySelector('.title')
		title.remove();
	}
	for (var secondary of document.querySelectorAll('.secondary')) {
		var primary = findPrimary(secondary);
		if (primary === null) {
			console.error("Found secondary block with no primary sibling");
		}
		else {
			var switchItem = createSwitchItem(secondary, primary.querySelector('.switch'));
			switchItem.content.classList.add("hidden");
			primary.append(switchItem.content);
			secondary.remove();
		}
	}
}

function createElementFromHtml(html) {
	var template = document.createElement('template');
    template.innerHTML = html;
    return template.content.firstChild;
}

function createBlockSwitch(primary) {
    var blockSwitch = createElementFromHtml('<div class="switch"></div>');
    primary.prepend(blockSwitch)
	return blockSwitch;
}

function findPrimary(secondary) {
	var candidate = secondary.previousElementSibling;
	while (candidate != null && !candidate.classList.contains('primary')) {
		candidate = candidate.previousElementSibling;
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	var blockName = block.querySelector('.title').textContent;
	var content = block.querySelectorAll('.content').item(0);
	var colist = nextSibling(block, '.colist');
	if (colist != null) {
		content.append(colist);
	}
	var item = createElementFromHtml('<div class="switch--item">' + blockName + '</div>');
	item.dataset.blockName = blockName;
	content.dataset.blockName = blockName;
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

function nextSibling(element, selector) {
	var sibling = element.nextElementSibling;
	while (sibling) {
		if (sibling.matches(selector)) {
			return sibling;
		}
		sibling = sibling.nextElementSibling;
	}
}

function globalSwitch() {
	document.querySelectorAll(".switch--item").forEach(function(item) {
		var blockId = blockIdForSwitchItem(item);
		var handler = function(event) {
			selectedText = event.target.textContent;
			window.localStorage.setItem(blockId, selectedText);
			for (var switchItem of document.querySelectorAll(".switch--item")) {
				if (blockIdForSwitchItem(switchItem) === blockId && switchItem.textContent === selectedText) {
					select(switchItem);
				}
			}
		}
		item.addEventListener("click", handler);
		if (item.textContent === window.localStorage.getItem(blockId)) {
			select(item);
		}
	});
}

function select(selected) {
	for (var child of selected.parentNode.children) {
		child.classList.remove("selected");
	}
	selected.classList.add("selected");
	for (var child of selected.parentNode.parentNode.children) {
		if (child.classList.contains("content")) {
			if (selected.dataset.blockName === child.dataset.blockName) {
				child.classList.remove("hidden");
			}
			else {
				child.classList.add("hidden");
			}
		}
	}	
}

function blockIdForSwitchItem(item) {
	idComponents = []
	for (var switchItem of item.parentNode.querySelectorAll(".switch--item")) {
		idComponents.push(switchItem.textContent.toLowerCase());
	}
	return idComponents.sort().join("-")
}

window.onload = function() {
	addBlockSwitches();
	globalSwitch();
};

</script>

</head>
<body id="datasource-micrometer-reference-documentation" class="book toc2 toc-left">
<div id="header">
<h1>Datasource Micrometer Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Tadaya Tsuyukubo</span><br>
<span id="revnumber">version 1.1.0-SNAPSHOT</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#legal">1. Legal</a></li>
<li><a href="#getting-started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#getting-started-introducing-datasource-micrometer">2.1. Introducing Datasource Micrometer</a>
<ul class="sectlevel3">
<li><a href="#getting-started-intro-background">2.1.1. Background</a></li>
<li><a href="#getting-started-intro-modules">2.1.2. Modules</a></li>
</ul>
</li>
<li><a href="#getting-started-installation">2.2. Installation</a>
<ul class="sectlevel3">
<li><a href="#getting-started-installation-maven-and-gradle">2.2.1. Maven and Gradle</a></li>
<li><a href="#getting-started-installation-setup">2.2.2. Setup</a></li>
</ul>
</li>
<li><a href="#getting-started-migration-from-spring-cloud-sleuth">2.3. Migration from Spring Cloud Sleuth</a></li>
</ul>
</li>
<li><a href="#using">3. Using Datasource Micrometer</a>
<ul class="sectlevel2">
<li><a href="#using-types-of-observation">3.1. Types of Observations</a></li>
<li><a href="#using-features">3.2. Features</a>
<ul class="sectlevel3">
<li><a href="#using-features-hikaricp-support">3.2.1. HikariCP Support</a></li>
<li><a href="#using-features-remote-ip-and-port">3.2.2. Remote IP and Port</a></li>
<li><a href="#using-features-remote-service-name">3.2.3. Remote Service Name</a></li>
<li><a href="#using-features-application-events">3.2.4. Application Events</a></li>
</ul>
</li>
<li><a href="#using-limitations">3.3. Limitations</a>
<ul class="sectlevel3">
<li><a href="#using-limitations-open-session-in-view">3.3.1. Open Session In View</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#howto">4. &#8220;How-to&#8221; Guides</a>
<ul class="sectlevel2">
<li><a href="#how-to-datasource-micrometer">4.1. datasource-micrometer</a>
<ul class="sectlevel3">
<li><a href="#how-to-instrument-datasource">4.1.1. How to instrument <code>DataSource</code></a></li>
<li><a href="#how-to-add-tracingobservationhandler">4.1.2. How to Add Tracing Observation Handlers for JDBC operations</a></li>
<li><a href="#how-to-instrument-resultset">4.1.3. How to Instrument <code>ResultSet</code></a></li>
<li><a href="#how-to-instrument-generated-keys">4.1.4. How to Instrument Generated Keys</a></li>
<li><a href="#how-to-include-bind-parameter-values">4.1.5. How to Include Bind Parameter Values</a></li>
</ul>
</li>
<li><a href="#how-to-datasource-micrometer-spring-boot">4.2. datasource-micrometer-spring-boot</a>
<ul class="sectlevel3">
<li><a href="#how-to-disable-jdbc-instrumentation">4.2.1. How to Disable JDBC Instrumentation</a></li>
<li><a href="#how-to-choose-what-to-observe">4.2.2. How to Choose What To Observe</a></li>
<li><a href="#how-to-include-bind-parameter-values-in-boot">4.2.3. How to Include the Bind Parameter Values in Spans</a></li>
<li><a href="#how-to-enable-and-configure-query-logging">4.2.4. How to Enable and Configure Query Logging</a></li>
<li><a href="#how-to-customize-the-proxydatasource-name">4.2.5. How to Customize the ProxyDataSource Name</a></li>
<li><a href="#how-to-customize-the-proxydatasource-creation">4.2.6. How to Customize the ProxyDataSource Creation</a></li>
<li><a href="#how-to-modify-the-query-in-span">4.2.7. How to Modify the Query in Span</a></li>
<li><a href="#how-to-publish-application-events">4.2.8. How to Enable Application Events</a></li>
<li><a href="#how-to-selectively-tag-queries">4.2.9. How to Selectively Tag Queries</a></li>
<li><a href="#how-to-use-custom-observationconvention">4.2.10. How to Use Custom ObservationConvention</a></li>
<li><a href="#how-to-switch-to-use-proxydatasource">4.2.11. How to Switch to Use ProxyDataSource</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#appendix">5. Appendix</a>
<ul class="sectlevel2">
<li><a href="#appendix-common-application-properties">5.1. Common Spring Boot application properties</a></li>
<li><a href="#appendix-observability-metrics-and-spans">5.2. Observability Metrics and Spans</a>
<ul class="sectlevel3">
<li><a href="#observability-conventions">5.2.1. Observability - Conventions</a></li>
<li><a href="#observability-metrics">5.2.2. Observability - Metrics</a></li>
<li><a href="#observability-spans">5.2.3. Observability - Spans</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="legal"><a class="anchor" href="#legal"></a><a class="link" href="#legal">1. Legal</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright &#169; 2022</p>
</div>
<div class="paragraph">
<p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a><a class="link" href="#getting-started">2. Getting Started</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are getting started with Datasource Micrometer, start by reading this section.
It answers the basic &#8220;what?&#8221;, &#8220;how?&#8221; and &#8220;why?&#8221; questions.
It includes an introduction to Datasource Micrometer, along with installation instructions.</p>
</div>
<div class="sect2">
<h3 id="getting-started-introducing-datasource-micrometer"><a class="anchor" href="#getting-started-introducing-datasource-micrometer"></a><a class="link" href="#getting-started-introducing-datasource-micrometer">2.1. Introducing Datasource Micrometer</a></h3>
<div class="paragraph">
<p>The Datasource Micrometer provides <a href="https://docs.micrometer.io/micrometer/reference/observation.html">Micrometer Observation API</a> instrumentation for JDBC operations.</p>
</div>
<div class="paragraph">
<p>Currently, this project provides two modules - core instrumentation and its Spring Boot Auto Configuration.</p>
</div>
<div class="paragraph">
<p>If you are a <a href="https://micrometer.io">Micrometer</a> user but not using Spring Boot, you can directly use the <code>datasource-micrometer</code> module, which doesn&#8217;t have a dependency on the Spring Framework.<br>
If you are a Spring Boot 3 user, then you can add the <code>datasource-micrometer-spring-boot</code> module to the classpath.
This will automatically instruments the <code>DataSource</code> and provide tracing capabilities for JDBC operations.</p>
</div>
<div class="paragraph">
<p>The instrumentation implementation uses <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> to provide a proxy for JDBC operations.</p>
</div>
<div class="sect3">
<h4 id="getting-started-intro-background"><a class="anchor" href="#getting-started-intro-background"></a><a class="link" href="#getting-started-intro-background">2.1.1. Background</a></h4>
<div class="paragraph">
<p>The Micrometer v1.10.0 introduced the new <a href="https://docs.micrometer.io/micrometer/reference/observation.html">Observation API</a> and <a href="https://docs.micrometer.io/tracing/reference/">Micrometer Tracing</a> module.
The <a href="https://docs.micrometer.io/micrometer/reference/observation.html">Observation API</a> allows measuring(observing) any interested behavior from the code in action. Then, notifies it to the registered handlers.
The <a href="https://docs.micrometer.io/tracing/reference/">Micrometer Tracing</a> module provides an observation handler implementation that creates distributed traces(spans). It uses a tracer that has abstracted the popular tracer implementations and gives the vendor free APIs for tracing.</p>
</div>
<div class="paragraph">
<p>In Spring Boot 2.x, the <a href="https://spring.io/projects/spring-cloud-sleuth">Spring Cloud Sleuth</a> provided the instrumentation to the many components including JDBC operations.
It was a central library that provides tracing instrumentation to the Spring Boot applications.
However, with the new observability, the responsibility for instrumentation has shifted to the individual component.
For example, Spring Framework will provide native instrumentation support for its components using the <a href="https://docs.micrometer.io/micrometer/reference/observation.html">Observation API</a>.
As a result, there will be no <a href="https://spring.io/projects/spring-cloud-sleuth">Spring Cloud Sleuth</a> for Spring Boot 3.</p>
</div>
<div class="paragraph">
<p>This Datasource Micrometer project provides instrumentation on the JDBC operations to cover what was provided by the <a href="https://spring.io/projects/spring-cloud-sleuth">Spring Cloud Sleuth</a> but with the <a href="https://docs.micrometer.io/micrometer/reference/observation.html">Observation API</a>.
The initial version aims users to smoothly transition from Spring Boot 2.x with Spring Cloud Sleuth to the Spring Boot 3 in JDBC instrumentation.
In addition, since the <a href="https://docs.micrometer.io/micrometer/reference/observation.html">Observation API</a> and <a href="https://docs.micrometer.io/tracing/reference/">Micrometer Tracing</a> are independent from Spring ecosystem, the instrumentation is available to the non-spring applications as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-intro-modules"><a class="anchor" href="#getting-started-intro-modules"></a><a class="link" href="#getting-started-intro-modules">2.1.2. Modules</a></h4>
<div class="paragraph">
<p><strong>datasource-micrometer</strong></p>
</div>
<div class="paragraph">
<p>This module provides the instrumentation on the JDBC operations.
The implementation is provided as a <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> listener.
Non-spring applications can directly use this module.</p>
</div>
<div class="paragraph">
<p><strong>datasource-micrometer-spring-boot</strong></p>
</div>
<div class="paragraph">
<p>This module provides an auto-configuration for the Spring Boot 3 applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-installation"><a class="anchor" href="#getting-started-installation"></a><a class="link" href="#getting-started-installation">2.2. Installation</a></h3>
<div class="sect3">
<h4 id="getting-started-installation-maven-and-gradle"><a class="anchor" href="#getting-started-installation-maven-and-gradle"></a><a class="link" href="#getting-started-installation-maven-and-gradle">2.2.1. Maven and Gradle</a></h4>
<div class="paragraph">
<p><strong>datasource-micrometer</strong></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;net.ttddyy.observation&lt;/groupId&gt;
    &lt;artifactId&gt;datasource-micrometer&lt;/artifactId&gt;
    &lt;version&gt;1.1.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation "net.ttddyy.observation:datasource-micrometer:1.1.0-SNAPSHOT"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>datasource-micrometer-spring-boot</strong></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;net.ttddyy.observation&lt;/groupId&gt;
    &lt;artifactId&gt;datasource-micrometer-spring-boot&lt;/artifactId&gt;
    &lt;version&gt;1.1.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation "net.ttddyy.observation:datasource-micrometer-spring-boot:1.1.0-SNAPSHOT"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-installation-setup"><a class="anchor" href="#getting-started-installation-setup"></a><a class="link" href="#getting-started-installation-setup">2.2.2. Setup</a></h4>
<div class="paragraph">
<p><strong>datasource-micrometer</strong></p>
</div>
<div class="paragraph">
<p>To setup the observation for JDBC operations, <a href="#how-to-instrument-datasource">create a proxy of your DataSource</a>, then <a href="#how-to-add-tracingobservationhandler">register the corresponding tracing observation handlers</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Register the tracing observation handlers
ObservationRegistry observationRegistry = ObservationRegistry.create();
ObservationConfig observationConfig = observationRegistry.observationConfig();
observationConfig.observationHandler(new ConnectionTracingObservationHandler(tracer));
observationConfig.observationHandler(new QueryTracingObservationHandler(tracer));
observationConfig.observationHandler(new ResultSetTracingObservationHandler(tracer));
//  add other necessary handlers

// Create a DataSource proxy with the observation listener
DataSource dataSource = ...
DataSourceObservationListener listener = new DataSourceObservationListener(observationRegistry);
DataSource instrumented = ProxyDataSourceBuilder.create(dataSource).listener(listener).methodListener(listener).build;

// Use the instrumented DataSource</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>datasource-micrometer-spring-boot</strong></p>
</div>
<div class="paragraph">
<p>The auto-configuration class automatically sets up the observation on your <code>DataSource</code> bean.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-migration-from-spring-cloud-sleuth"><a class="anchor" href="#getting-started-migration-from-spring-cloud-sleuth"></a><a class="link" href="#getting-started-migration-from-spring-cloud-sleuth">2.3. Migration from Spring Cloud Sleuth</a></h3>
<div class="paragraph">
<p>Datasource Micrometer deliberately provides similar property names to ease the migration from <a href="https://spring.io/projects/spring-cloud-sleuth">Spring Cloud Sleuth</a>.
Most of the JDBC related properties from <code>spring.sleuth.jdbc</code> and <code>spring.sleuth.jdbc.datasource-proxy</code> map to the <code>jdbc</code> and <code>jdbc.datasource-proxy</code> properties.</p>
</div>
<div class="paragraph">
<p>Please reference the list of application properties in <a href="https://docs.spring.io/spring-cloud-sleuth/docs/current/reference/html/appendix.html#common-application-properties">Spring Cloud Sleuth</a> and <a href="#appendix-common-application-properties">Datasource Micrometer</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using"><a class="anchor" href="#using"></a><a class="link" href="#using">3. Using Datasource Micrometer</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section goes into more detail about how you should use Datasource Micrometer.</p>
</div>
<div class="sect2">
<h3 id="using-types-of-observation"><a class="anchor" href="#using-types-of-observation"></a><a class="link" href="#using-types-of-observation">3.1. Types of Observations</a></h3>
<div class="paragraph">
<p>The Datasource Micrometer creates Connection, Query, Generated Keys(from <code>v1.1</code>), and ResultSet observations.</p>
</div>
<div class="paragraph">
<p>The Connection observation represents the database connection operations. It is the base observation, as any database access requires a connection.
The Query observation provides query execution details, such as execution time, SQL query, bind parameters, etc.
The Generated Keys observation records generated keys when auto-generated keys feature is used for the insert statements.
The ResultSet observation shows how the operations fetched the data from the query result, including the number of retrieved rows.</p>
</div>
<div class="paragraph">
<p>To configure these observations, see <a href="#how-to-add-tracingobservationhandler">How to Add Tracing Observation Handlers for JDBC operations</a>. <br>
For Spring Boot, see <a href="#how-to-choose-what-to-observe">How to Choose What To Observe</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-features"><a class="anchor" href="#using-features"></a><a class="link" href="#using-features">3.2. Features</a></h3>
<div class="sect3">
<h4 id="using-features-hikaricp-support"><a class="anchor" href="#using-features-hikaricp-support"></a><a class="link" href="#using-features-hikaricp-support">3.2.1. HikariCP Support</a></h4>
<div class="paragraph">
<p><code>jdbc.datasource.driver</code> and <code>jdbc.datasource.pool</code> tags are available when the target datasource is a <code>HikariDataSource</code>.</p>
</div>
<div class="paragraph">
<p>The <code>HikariJdbcObservationFilter</code> provides this feature and this observation filter needs to be registered to the <code>ObservationRegistry</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ObservationRegistry registry = ...
registry.observationConfig().observationFilter(new HikariJdbcObservationFilter());</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is auto configured in <code>datasource-micrometer-spring-boot</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-features-remote-ip-and-port"><a class="anchor" href="#using-features-remote-ip-and-port"></a><a class="link" href="#using-features-remote-ip-and-port">3.2.2. Remote IP and Port</a></h4>
<div class="paragraph">
<p>For spans, remote IP and port are retrieved from the datasource url.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-features-remote-service-name"><a class="anchor" href="#using-features-remote-service-name"></a><a class="link" href="#using-features-remote-service-name">3.2.3. Remote Service Name</a></h4>
<div class="paragraph">
<p>The datasource name is used as the remote service name in spans.
The name is specified when creating a proxy datasource by <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource instrumented =
    ProxyDataSourceBuilder.create(dataSource)
        .name("myDS")    // Specify datasource name
        .listener(listener)
        .methodListener(listener)
        .build;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>datasource-micrometer-spring-boot</code>, the datasource name is resolved by looking the catalog name at start up (or the connection pool name for Hikari, then fallback to its beanname) by default.</p>
</div>
<div class="paragraph">
<p>To specify a custom datasource name, see <a href="#how-to-customize-the-proxydatasource-name">How to Customize the ProxyDataSource Name</a> and <a href="#how-to-customize-the-proxydatasource-creation">How to Customize the ProxyDataSource Creation</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-features-application-events"><a class="anchor" href="#using-features-application-events"></a><a class="link" href="#using-features-application-events">3.2.4. Application Events</a></h4>
<div class="paragraph">
<p>Since version <code>1.1</code>, <code>datasource-micrometer-spring-boot</code> can publish Spring&#8217;s application events for query executions and method invocations on proxied JDBC classes.
This feature is disabled by default and can be enabled by setting the property <code>jdbc.event.enabled=true</code>.
When enabled, it publishes events - <code>JdbcQueryExecutionEvent</code> and <code>JdbcMethodExecutionEvenet</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-limitations"><a class="anchor" href="#using-limitations"></a><a class="link" href="#using-limitations">3.3. Limitations</a></h3>
<div class="sect3">
<h4 id="using-limitations-open-session-in-view"><a class="anchor" href="#using-limitations-open-session-in-view"></a><a class="link" href="#using-limitations-open-session-in-view">3.3.1. Open Session In View</a></h4>
<div class="paragraph">
<p>Unfortunately, Open Session In View (OSIV) is not supported.
This is because OSIV delays closing the database connection until the HTTP response is sent.</p>
</div>
<div class="paragraph">
<p>Observation scope orders without OSIV:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open HTTP request observation scope</p>
</li>
<li>
<p>Open DB connection observation scope</p>
</li>
<li>
<p>(Other observation scopes)</p>
</li>
<li>
<p>Close DB connection observation scope</p>
</li>
<li>
<p>Close HTTP request observation scope</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>However, with OSIV enabled, the DB connection closing is delayed, leading to the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open HTTP request observation scope</p>
</li>
<li>
<p>Open DB connection observation scope</p>
</li>
<li>
<p>(Other observation scopes)</p>
</li>
<li>
<p><strong>(SWAPPED)</strong> Close HTTP request observation scope</p>
</li>
<li>
<p><strong>(SWAPPED)</strong> Close DB connection observation scope</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since observation scopes must be closed in the reverse order of their creation, this swapped ordering causes observation leaks.</p>
</div>
<div class="paragraph">
<p>To disable OSIV, set <code>spring.jpa.open-in-view=false</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="howto"><a class="anchor" href="#howto"></a><a class="link" href="#howto">4. &#8220;How-to&#8221; Guides</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides answers to some common &#8220;how do I do that&#8230;&#8203;?&#8221; questions.
Its coverage is not exhaustive, but it does cover quite a lot.</p>
</div>
<div class="paragraph">
<p>We are also more than happy to extend this section.
If you want to add a &#8220;how-to&#8221;, send us a <a href="https://github.com/jdbc-observations/datasource-micrometer/pulls/">pull request</a>.</p>
</div>
<div class="sect2">
<h3 id="how-to-datasource-micrometer"><a class="anchor" href="#how-to-datasource-micrometer"></a><a class="link" href="#how-to-datasource-micrometer">4.1. datasource-micrometer</a></h3>
<div class="sect3">
<h4 id="how-to-instrument-datasource"><a class="anchor" href="#how-to-instrument-datasource"></a><a class="link" href="#how-to-instrument-datasource">4.1.1. How to instrument <code>DataSource</code></a></h4>
<div class="paragraph">
<p>The <code>DataSourceObservationListener</code> provides the observation logic.
It is implemented as a <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> listener.
Follow the <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> usage to create a proxied <code>DataSource</code> with the listener.
Then <a href="#how-to-add-tracingobservationhandler">adds tracing observation handlers</a> to the <code>ObservationRegistry</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ObservationRegistry observationRegistry = ...
DataSourceObservationListener listener = new DataSourceObservationListener(observationRegistry);
DataSource instrumented = ProxyDataSourceBuilder.create(dataSource).listener(listener).methodListener(listener).build;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-add-tracingobservationhandler"><a class="anchor" href="#how-to-add-tracingobservationhandler"></a><a class="link" href="#how-to-add-tracingobservationhandler">4.1.2. How to Add Tracing Observation Handlers for JDBC operations</a></h4>
<div class="paragraph">
<p>There are 3 tracing observation handlers that react to the observations from <code>DataSourceObservationListener</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ConnectionTracingObservationHandler</code></p>
</li>
<li>
<p><code>QueryTracingObservationHandler</code></p>
</li>
<li>
<p><code>ResultSetTracingObservationHandler</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
generated-keys are also handled by <code>ResultSetTracingObservationHandler</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ObservationRegistry registry = ...
registry.observationConfig().observationHandler(new ConnectionTracingObservationHandler(tracer));
registry.observationConfig().observationHandler(new QueryTracingObservationHandler(tracer));
registry.observationConfig().observationHandler(new ResultSetTracingObservationHandler(tracer));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-instrument-resultset"><a class="anchor" href="#how-to-instrument-resultset"></a><a class="link" href="#how-to-instrument-resultset">4.1.3. How to Instrument <code>ResultSet</code></a></h4>
<div class="paragraph">
<p>By default, <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> does not create a proxy for <code>ResultSet</code>.
This, in turn, does not instrument the <code>ResultSet</code>.
You need to explicitly enable the <code>ResultSet</code> proxy creation.
Then, <code>ResultSet</code> get instrumented automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ProxyDataSourceBuilder builder = ProxyDataSourceBuilder.create(dataSource).listener(listener).methodListener(listener);
builder.proxyResultSet();  // enable ResultSet proxy creation
DataSource instrumented = builder.build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-instrument-generated-keys"><a class="anchor" href="#how-to-instrument-generated-keys"></a><a class="link" href="#how-to-instrument-generated-keys">4.1.4. How to Instrument Generated Keys</a></h4>
<div class="paragraph">
<p>By default, <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> does not create a proxy for the generated-keys.
You need to explicitly enable the generated-keys proxy creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ProxyDataSourceBuilder builder = ProxyDataSourceBuilder.create(dataSource).listener(listener).methodListener(listener);
builder.proxyGeneratedKeys();  // enable Generated-Keys proxy creation
DataSource instrumented = builder.build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-include-bind-parameter-values"><a class="anchor" href="#how-to-include-bind-parameter-values"></a><a class="link" href="#how-to-include-bind-parameter-values">4.1.5. How to Include Bind Parameter Values</a></h4>
<div class="paragraph">
<p>Bind parameter values - values from <code>setInt</code>, <code>setString</code>, etc operations on prepared and callable statement - are not tagged to spans by default.
The <code>DataSourceObservationListener</code> class has a toggle to enable this.
When it is enabled, values are tagged to the query spans as <code>jdbc.params[]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSourceObservationListener listener = ...;
listener.setIncludeParameterValues(true);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-datasource-micrometer-spring-boot"><a class="anchor" href="#how-to-datasource-micrometer-spring-boot"></a><a class="link" href="#how-to-datasource-micrometer-spring-boot">4.2. datasource-micrometer-spring-boot</a></h3>
<div class="sect3">
<h4 id="how-to-disable-jdbc-instrumentation"><a class="anchor" href="#how-to-disable-jdbc-instrumentation"></a><a class="link" href="#how-to-disable-jdbc-instrumentation">4.2.1. How to Disable JDBC Instrumentation</a></h4>
<div class="paragraph">
<p>Set the <code>jdbc.datasource-proxy.enabled</code> property to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-choose-what-to-observe"><a class="anchor" href="#how-to-choose-what-to-observe"></a><a class="link" href="#how-to-choose-what-to-observe">4.2.2. How to Choose What To Observe</a></h4>
<div class="paragraph">
<p>Specify <code>jdbc.includes</code> property.
By default, the property is set to include(observe) all(<code>CONNECTION</code>, <code>QUERY</code>,
<code>KEYS</code>, <code>FETCH</code>) types.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-include-bind-parameter-values-in-boot"><a class="anchor" href="#how-to-include-bind-parameter-values-in-boot"></a><a class="link" href="#how-to-include-bind-parameter-values-in-boot">4.2.3. How to Include the Bind Parameter Values in Spans</a></h4>
<div class="paragraph">
<p>Set the <code>jdbc.datasource-proxy.include-parameter-values</code> property to <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-enable-and-configure-query-logging"><a class="anchor" href="#how-to-enable-and-configure-query-logging"></a><a class="link" href="#how-to-enable-and-configure-query-logging">4.2.4. How to Enable and Configure Query Logging</a></h4>
<div class="paragraph">
<p>To enable the query logging, set the <code>jdbc.datasource-proxy.query.enable-logging</code> property to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jdbc.datasource-proxy.query.enable-logging=true

# logging configuration
jdbc.datasource-proxy.logging=slf4j
jdbc.datasource-proxy.query.log-level=DEBUG
jdbc.datasource-proxy.query.logger-name=my.query-logger
jdbc.datasource-proxy.multiline=false

# spring boot log level property
logging.level.my.query-logger=DEBUG</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-customize-the-proxydatasource-name"><a class="anchor" href="#how-to-customize-the-proxydatasource-name"></a><a class="link" href="#how-to-customize-the-proxydatasource-name">4.2.5. How to Customize the ProxyDataSource Name</a></h4>
<div class="paragraph">
<p>Create a custom <code>DataSourceNameResolver</code> bean.
It replaces the default bean, <code>DefaultDataSourceNameResolver</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-customize-the-proxydatasource-creation"><a class="anchor" href="#how-to-customize-the-proxydatasource-creation"></a><a class="link" href="#how-to-customize-the-proxydatasource-creation">4.2.6. How to Customize the ProxyDataSource Creation</a></h4>
<div class="paragraph">
<p>The <code>ProxyDataSourceBuilderCustomizer</code> beans are automatically called before creating a proxy datasource.
This callback API allows you to customize the <code>ProxyDataSourceBuilder</code>.</p>
</div>
<div class="paragraph">
<p>For example, you can use  <code>ProxyDataSourceBuilderCustomizer</code> to specify the datasource proxy name. In turn, it becomes the remote service name of the spans.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public ProxyDataSourceBuilderCustomizer myCustomizer(){
    return (builder, dataSource, beanName, dataSourceName) -&gt; {
        builder.name("MyAppDataSource");
    };
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-modify-the-query-in-span"><a class="anchor" href="#how-to-modify-the-query-in-span"></a><a class="link" href="#how-to-modify-the-query-in-span">4.2.7. How to Modify the Query in Span</a></h4>
<div class="paragraph">
<p>If you want to modify the query string in the span (in high cardinality tags), use <code>ObservationFilter</code> to update the tag value.
For example, you could perform sanitization, truncation, etc on the query.</p>
</div>
<div class="paragraph">
<p>This approach is generally applicable to modify any tags in span.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>ObservationFilter</code> is applied when the observation stops.
The modification will not be available for timers created by <code>DefaultMeterObservationHandler</code> since it sets the timers at observation start.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public ObservationFilter observationFilter() {
    return (context) -&gt; {
        String tagKey = QueryHighCardinalityKeyNames.QUERY.name();
        KeyValue tag = context.getHighCardinalityKeyValue(tagKey);
        if(tag != null) {
            String query = tag.getValue();

            // ... modify query

            context.addHighCardinalityKeyValue(KeyValue.of(tagKey, modifiedQuery));
        }
        return context;
    };
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-publish-application-events"><a class="anchor" href="#how-to-publish-application-events"></a><a class="link" href="#how-to-publish-application-events">4.2.8. How to Enable Application Events</a></h4>
<div class="paragraph">
<p>Set the <code>jdbc.event.enabled</code> property to <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-selectively-tag-queries"><a class="anchor" href="#how-to-selectively-tag-queries"></a><a class="link" href="#how-to-selectively-tag-queries">4.2.9. How to Selectively Tag Queries</a></h4>
<div class="paragraph">
<p>Instead of tagging all queries, you can define an <code>ObservationPredicate</code> bean to selectively tag queries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
ObservationPredicate myObservationPredicate() {
    return (name, context) -&gt; {
        if(context instanceof QueryContext queryContext) {
            return queryContext.getQueries().stream().noneMatch(query -&gt; query.contains("QUERY TO IGNORE"));
        }
        return true;
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Kotlin-flavored implementation can be found on this <a href="https://github.com/jdbc-observations/datasource-micrometer/issues/17#issuecomment-2668657969">issue comment</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-use-custom-observationconvention"><a class="anchor" href="#how-to-use-custom-observationconvention"></a><a class="link" href="#how-to-use-custom-observationconvention">4.2.10. How to Use Custom ObservationConvention</a></h4>
<div class="paragraph">
<p>Define beans for your custom observation conventions, which will then be automatically detected and applied to the listener.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-switch-to-use-proxydatasource"><a class="anchor" href="#how-to-switch-to-use-proxydatasource"></a><a class="link" href="#how-to-switch-to-use-proxydatasource">4.2.11. How to Switch to Use ProxyDataSource</a></h4>
<div class="paragraph">
<p>Since version <code>1.1</code>, the instrumented <code>DataSource</code> is now a pure JDK proxy.
To revert to the previous behavior using <code>ProxyDataSource</code>, set the property: <code>jdbc.datasource-proxy.type=CONCRETE</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="#appendix"></a><a class="link" href="#appendix">5. Appendix</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="appendix-common-application-properties"><a class="anchor" href="#appendix-common-application-properties"></a><a class="link" href="#appendix-common-application-properties">5.1. Common Spring Boot application properties</a></h3>
<div class="paragraph">
<p>Various properties can be specified inside your <code>application.properties</code> file, inside your <code>application.yml</code> file, or as command line switches.
This appendix provides a list of common Datasource Micrometer properties and references to the underlying classes that consume them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Property contributions can come from additional jar files on your classpath, so you should not consider this an exhaustive list.
Also, you can define your own properties.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable JDBC instrumentation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.include-parameter-values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to tag actual query parameter values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.json-format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use json output for logging query. @see ProxyDataSourceBuilder#asJson()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slf4j</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging to use for logging queries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.multiline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use multiline output for logging query. @see ProxyDataSourceBuilder#multiline()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.query.enable-logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable logging all queries to the log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.query.log-level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEBUG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Severity of query logger.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.query.logger-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of query logger.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.slow-query.enable-logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable logging slow queries to the log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.slow-query.log-level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WARN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Severity of slow query logger.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.slow-query.logger-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of slow query logger.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.slow-query.threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds to consider query as slow.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.datasource-proxy.type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type for the generating DataSource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.event.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable publishing query/method execution events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.excluded-data-source-bean-names</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of DataSource bean names that will not be decorated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc.includes</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Which types of tracing we would like to include.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="appendix-observability-metrics-and-spans"><a class="anchor" href="#appendix-observability-metrics-and-spans"></a><a class="link" href="#appendix-observability-metrics-and-spans">5.2. Observability Metrics and Spans</a></h3>
<div class="sect3">
<h4 id="observability-conventions"><a class="anchor" href="#observability-conventions"></a><a class="link" href="#observability-conventions">5.2.1. Observability - Conventions</a></h4>
<div class="paragraph">
<p>Below you can find a list of all <code>GlobalObservationConvention</code> and <code>ObservationConvention</code> declared by this project.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. ObservationConvention implementations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObservationConvention Class Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicable ObservationContext Class Name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.ttddyy.observation.tracing.ConnectionObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ConnectionContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.ttddyy.observation.tracing.QueryObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>QueryContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.ttddyy.observation.tracing.GeneratedKeysObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResultSetContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.ttddyy.observation.tracing.ResultSetObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResultSetContext</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="observability-metrics"><a class="anchor" href="#observability-metrics"></a><a class="link" href="#observability-metrics">5.2.2. Observability - Metrics</a></h4>
<div class="paragraph">
<p>Below you can find a list of all metrics declared by this project.</p>
</div>
<div class="sect4">
<h5 id="observability-metrics-connection"><a class="anchor" href="#observability-metrics-connection"></a><a class="link" href="#observability-metrics-connection">Connection</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Span created when a JDBC connection takes place.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.connection</code>. <strong>Type</strong> <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.connection.active</code>. <strong>Type</strong> <code>long task timer</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
KeyValues that are added after starting the Observation might be missing from the *.active metrics.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micrometer internally uses <code>nanoseconds</code> for the baseunit. However, each backend determines the actual baseunit. (i.e. Prometheus uses seconds)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>net.ttddyy.observation.tracing.JdbcObservationDocumentation</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All tags must be prefixed with <code>jdbc</code> prefix!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Low cardinality Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>jdbc.datasource.driver</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the JDBC datasource driver. (HikariCP only)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>jdbc.datasource.name</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the JDBC datasource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>jdbc.datasource.pool</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the JDBC datasource pool. (HikariCP only)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Since, events were set on this documented entry, they will be converted to the following counters.</p>
</div>
<div class="sect5">
<h6 id="observability-metrics-connection-jdbc-connection-acquired"><a class="anchor" href="#observability-metrics-connection-jdbc-connection-acquired"></a><a class="link" href="#observability-metrics-connection-jdbc-connection-acquired">Connection - jdbc connection acquired</a></h6>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>When the connection is acquired. This event is recorded right after successful "getConnection()" call.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.connection.acquired</code>. <strong>Type</strong> <code>counter</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="observability-metrics-connection-jdbc-connection-commit"><a class="anchor" href="#observability-metrics-connection-jdbc-connection-commit"></a><a class="link" href="#observability-metrics-connection-jdbc-connection-commit">Connection - jdbc connection commit</a></h6>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>When the connection is committed.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.connection.commit</code>. <strong>Type</strong> <code>counter</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="observability-metrics-connection-jdbc-connection-rollback"><a class="anchor" href="#observability-metrics-connection-jdbc-connection-rollback"></a><a class="link" href="#observability-metrics-connection-jdbc-connection-rollback">Connection - jdbc connection rollback</a></h6>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>When the connection is rolled back.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.connection.rollback</code>. <strong>Type</strong> <code>counter</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="observability-metrics-generated-keys"><a class="anchor" href="#observability-metrics-generated-keys"></a><a class="link" href="#observability-metrics-generated-keys">Generated Keys</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Span created when generated keys are returned.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.generated-keys</code>. <strong>Type</strong> <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.generated-keys.active</code>. <strong>Type</strong> <code>long task timer</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
KeyValues that are added after starting the Observation might be missing from the *.active metrics.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micrometer internally uses <code>nanoseconds</code> for the baseunit. However, each backend determines the actual baseunit. (i.e. Prometheus uses seconds)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>net.ttddyy.observation.tracing.JdbcObservationDocumentation</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All tags must be prefixed with <code>jdbc</code> prefix!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Low cardinality Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>jdbc.datasource.name</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the JDBC datasource.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="observability-metrics-query"><a class="anchor" href="#observability-metrics-query"></a><a class="link" href="#observability-metrics-query">Query</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Span created when executing a query.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.query</code>. <strong>Type</strong> <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.query.active</code>. <strong>Type</strong> <code>long task timer</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
KeyValues that are added after starting the Observation might be missing from the *.active metrics.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micrometer internally uses <code>nanoseconds</code> for the baseunit. However, each backend determines the actual baseunit. (i.e. Prometheus uses seconds)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>net.ttddyy.observation.tracing.JdbcObservationDocumentation</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All tags must be prefixed with <code>jdbc</code> prefix!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Low cardinality Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>jdbc.datasource.name</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the JDBC datasource.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="observability-metrics-result-set"><a class="anchor" href="#observability-metrics-result-set"></a><a class="link" href="#observability-metrics-result-set">Result Set</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Span created when working with JDBC result set.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.result-set</code>. <strong>Type</strong> <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>jdbc.result-set.active</code>. <strong>Type</strong> <code>long task timer</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
KeyValues that are added after starting the Observation might be missing from the *.active metrics.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micrometer internally uses <code>nanoseconds</code> for the baseunit. However, each backend determines the actual baseunit. (i.e. Prometheus uses seconds)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>net.ttddyy.observation.tracing.JdbcObservationDocumentation</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All tags must be prefixed with <code>jdbc</code> prefix!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Low cardinality Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>jdbc.datasource.name</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the JDBC datasource.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="observability-spans"><a class="anchor" href="#observability-spans"></a><a class="link" href="#observability-spans">5.2.3. Observability - Spans</a></h4>
<div class="paragraph">
<p>Below you can find a list of all spans declared by this project.</p>
</div>
<div class="sect4">
<h5 id="observability-spans-connection"><a class="anchor" href="#observability-spans-connection"></a><a class="link" href="#observability-spans-connection">Connection Span</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Span created when a JDBC connection takes place.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Span name</strong> <code>connection</code>.</p>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>net.ttddyy.observation.tracing.JdbcObservationDocumentation</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All tags must be prefixed with <code>jdbc</code> prefix!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Tag Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.datasource.driver</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the JDBC datasource driver. (HikariCP only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.datasource.name</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the JDBC datasource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.datasource.pool</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the JDBC datasource pool. (HikariCP only)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Event Values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>acquired</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the connection is acquired. This event is recorded right after successful "getConnection()" call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the connection is committed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rollback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the connection is rolled back.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="observability-spans-generated-keys"><a class="anchor" href="#observability-spans-generated-keys"></a><a class="link" href="#observability-spans-generated-keys">Generated Keys Span</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Span created when generated keys are returned.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Span name</strong> <code>generated-keys</code>.</p>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>net.ttddyy.observation.tracing.JdbcObservationDocumentation</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All tags must be prefixed with <code>jdbc</code> prefix!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Tag Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.datasource.name</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the JDBC datasource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.generated-keys</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generated keys.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="observability-spans-query"><a class="anchor" href="#observability-spans-query"></a><a class="link" href="#observability-spans-query">Query Span</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Span created when executing a query.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Span name</strong> <code>query</code>.</p>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>net.ttddyy.observation.tracing.JdbcObservationDocumentation</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All tags must be prefixed with <code>jdbc</code> prefix!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Tag Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.datasource.name</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the JDBC datasource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.params[%s]</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC query parameter values. (since the name contains <code>%s</code> the final value will be resolved at runtime)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.query[%s]</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the JDBC query. (since the name contains <code>%s</code> the final value will be resolved at runtime)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.row-affected</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result of "executeUpdate()", "executeLargeUpdate()", "executeBatch()", or "executeLargeBatch()" on "Statement". For batch operations, the value is represented as array.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="observability-spans-result-set"><a class="anchor" href="#observability-spans-result-set"></a><a class="link" href="#observability-spans-result-set">Result Set Span</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Span created when working with JDBC result set.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Span name</strong> <code>result-set</code>.</p>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>net.ttddyy.observation.tracing.JdbcObservationDocumentation</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All tags must be prefixed with <code>jdbc</code> prefix!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Tag Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.datasource.name</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the JDBC datasource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc.row-count</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of SQL rows.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>